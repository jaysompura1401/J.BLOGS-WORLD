{% extends "base.html" %}
{% block content %}
<div class="container py-4">
  <div class="row">
    <div class="col-lg-8">
      <article>
        <h1>{{ post.title }}</h1>
        <p class="text-muted">By <a href="{% url 'profile_view' post.author.username %}">{{ post.author.username }}</a> • {{ post.created_at|date:"M d, Y" }}</p>
        {% if post.cover %}<img src="{{ post.cover.url }}" class="img-fluid mb-3">{% endif %}
        <div>{{ post.content|linebreaks }}</div>

        <div class="mt-3">
          {% if user.is_authenticated %}
            <a href="{% url 'like_post' post.id %}" class="btn btn-outline-primary me-2">{% if liked %}Unlike{% else %}Like{% endif %} ({{ post.likes.count }})</a>
            {% if user == post.author %}
              <a href="{% url 'post_edit' post.pk %}" class="btn btn-secondary">Edit</a>
              <form method="post" action="{% url 'post_delete' post.pk %}" style="display:inline;">{% csrf_token %}<button class="btn btn-danger">Delete</button></form>
            {% endif %}
          {% endif %}
        </div>
      </article>

      <section class="mt-4">
        <h5>Comments ({{ post.comments.count }})</h5>
        {% for c in post.comments.all %}
          <div class="border p-2 mb-2"><p>{{ c.content }}</p><p class="small text-muted">By {{ c.user }} • {{ c.created_at|date:"M d, Y H:i" }}</p></div>
        {% empty %}<p>No comments yet.</p>{% endfor %}

        <h6 class="mt-3">Add a comment</h6>
        <form method="post">{% csrf_token %}{{ comment_form.as_p }}<button class="btn btn-primary">Submit</button></form>
      </section>
    </div>

    <aside class="col-lg-4">
      <div class="card p-3 mb-3"><h6>About Author</h6><p>{{ post.author.username }}</p><p class="small text-muted">{{ post.author.profile.bio }}</p></div>
      <div class="card p-3"><h6>Tags</h6>{% for t in post.tags.all %}<a class="badge bg-light text-dark me-1 mb-1" href="{% url 'tag_posts' t.slug %}">{{ t.name }}</a>{% endfor %}</div>
    </aside>
  </div>
</div>
{% endblock %}
